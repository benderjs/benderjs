#!/usr/bin/env node
var argParser = require('nomnom'),
	configParser = require('../lib/configParser'),
    constants = require('../lib/constants');

// TODO read and parse config !!!

argParser.command('init')
    .callback(initialize)
    .help('Initialize Bender.js for this directory');

argParser.command('run')
    .callback(runTests)
    .help('Run tests on captured clients');

argParser.command('server')
    .callback(startServer)
    .option('port', {
        abbr: 'p',
        default: constants.PORT,
        help: 'Port on which the server will run'
    })
    // see if this option is really needed
    .option('hostname', {
        abbr: 'n', // YEAH.. should be h but it's reserved for nomnom's help
        default: constants.HOSTNAME,
        help: 'Hostname used to run server'
    })
    .help('Start Bender.js server');

argParser.command('version')
    .callback(function () {
        console.log('Bender.js v%s', constants.VERSION);
    })
    .help('Print Bender.js version');

argParser.parse();

function startServer(options) {
    var hs = require('../lib/http-server'),
        server = hs.create();

    server.listen(options.port, function () {
        console.log('Bender.js Server v%s started at http://%s:%s', constants.VERSION, options.hostname, options.port);
    });
}

function runTests(options) {
    // TODO
}

function initialize(options) {
    // TODO
}
